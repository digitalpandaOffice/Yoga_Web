<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Online Admission - Edvayu Educational Foundations</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,700;1,300&family=Montserrat:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="mainstyles.css">
    <style>
        /* Reuse form styles from Franchise Form + Customizations */
        .form-container {
            max-width: 800px;
            margin: 60px auto;
            padding: 0 20px;
        }

        .form-card {
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-family: 'Merriweather', serif;
            color: var(--deep-blue);
            font-size: 1.5rem;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 0.95rem;
        }

        .form-group label .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            font-family: 'Montserrat', sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--gold);
            outline: none;
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: var(--gold);
            color: var(--deep-blue);
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }

        .btn-submit:hover {
            background: #d4af37;
        }

        .page-hero {
            background: linear-gradient(rgba(11, 37, 69, 0.8), rgba(11, 37, 69, 0.8)), url('https://images.unsplash.com/photo-1544367563-12123d896889?auto=format&fit=crop&w=1600&q=80') center/cover;
            padding: 80px 0;
            text-align: center;
            color: #fff;
        }

        .page-hero h1 {
            font-family: 'Merriweather', serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="icon" type="image/png" href="images/AdvayuLogo.png">
</head>

<body>
    <!-- Top Banner -->
    <div class="top-banner">
        <img src="./images/AdvayuLogo.png" alt="Edvayu Educational Foundations Logo" class="top-logo" />
        <div class="top-title-group">
            <h1 class="top-title">Edvayu Educational Foundations</h1>
            <div class="top-subtitle">CULTURAL EXAMINATION BOARD</div>
        </div>
    </div>

    <!-- Navbar -->
    <header class="site-header">
        <nav class="navbar">
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li class="has-dropdown">
                    <a href="index.html#student">Student Area</a>
                    <ul class="dropdown">
                        <li><a href="admissions.html">Admissions</a></li>
                        <li><a href="syllabus.html">Syllabus</a></li>
                        <li><a href="results.html">Results</a></li>
                        <li><a href="student_resources.html">Resources</a></li>
                    </ul>
                </li>
                <li class="has-dropdown">
                    <a href="index.html#teacher">Teacher Area</a>
                    <ul class="dropdown">
                        <li><a href="teacher_login.html">Login</a></li>
                        <li><a href="teacher_curriculum.html">Curriculum</a></li>
                        <li><a href="teacher_training.html">Training</a></li>
                        <li><a href="teacher_resources.html">Resources</a></li>
                    </ul>
                </li>
                <li class="has-dropdown">
                    <a href="index.html#courses">Diploma Exam</a>
                    <ul class="dropdown">
                        <li><a href="exam_dates.html">Exam Dates</a></li>
                        <li><a href="exam_eligibility.html">Eligibility</a></li>
                        <li><a href="syllabus.html">Syllabus</a></li>
                        <li><a href="admit_card.html">Download Admit Card</a></li>
                    </ul>
                </li>
                <li class="has-dropdown">
                    <a href="index.html#franchise">Franchise Registration</a>
                    <ul class="dropdown">
                        <li><a href="franchiseRegistrationform.html">Become a Partner</a></li>
                        <li><a href="franchise_status.html">Franchise Status</a></li>
                        <li><a href="franchise_benefits.html">Benefits</a></li>
                        <li><a href="franchise_process.html">Process</a></li>
                        <li><a href="franchise_faqs.html">FAQs</a></li>
                    </ul>
                </li>
                <li><a href="gallarysection.html">Gallery</a></li>
                <li><a href="upcoming_events.html">Upcoming Events</a></li>
                <li class="has-dropdown">
                    <a href="#other">Other</a>
                    <ul class="dropdown">
                        <li><a href="policies.html">Policies</a></li>
                        <li><a href="alumni.html">Alumni</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="page-hero">
            <div class="container">
                <h1>Online Admission Form</h1>
                <p>Session 2025-26</p>
            </div>
        </section>

        <div class="form-container">
            <div class="form-card">
                <form action="#" method="POST" enctype="multipart/form-data" id="admissionForm">

                    <!-- Office Use Section -->
                    <div class="form-section"
                        style="background: #fdfdfd; padding: 20px; border: 1px dashed #ccc; margin-bottom: 30px;">
                        <h3 class="section-title" style="font-size: 1.2rem; border-bottom: none; margin-bottom: 15px;">
                            For Office Use / Header</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Sl. No.</label>
                                <input type="text" name="sl_no" value="OFFICE USE ONLY" disabled
                                    style="background: #eee;">
                            </div>
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" name="submission_date" id="dateField">
                                <script>document.getElementById('dateField').valueAsDate = new Date();</script>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Details -->
                    <div class="form-section">
                        <h3 class="section-title">1. Personal Details</h3>
                        <div class="form-grid">
                            <!-- Student Photo (New) -->
                            <div class="form-group"
                                style="grid-row: span 3; display: flex; flex-direction: column; align-items: center; justify-content: start;">
                                <div style="width: 150px; height: 180px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; background: #fafafa; margin-bottom: 10px; position: relative; overflow: hidden;"
                                    id="photoPreviewBox">
                                    <span
                                        style="color: #999; font-size: 0.9rem; text-align: center; padding: 10px;">Paste
                                        Passport Size Photo</span>
                                    <img id="photoPreviewImg"
                                        style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                </div>
                                <input type="file" name="student_photo" accept="image/*" required
                                    onchange="previewImage(this)">
                                <label style="font-size: 0.85rem; color: #666; margin-top: 5px;">(Max 2MB,
                                    JPG/PNG)</label>
                            </div>

                            <!-- Name -->
                            <div class="form-group">
                                <!-- Changed from full-width to accommodate photo on right or left used grid flow, but actually putting photo first might mess up grid if not careful. Let's make Name standard and handle photo carefully. -->
                                <!-- Actually, to keep it simple with grid: 
                                     I'll assume standard flow. The user wants it IN personal details.
                                     I'll add it as a full width field or side by side.
                                     Refactoring the grid slightly to look good. -->
                                <label>Name (In Capital Letters) <span class="required">*</span></label>
                                <input type="text" name="full_name" required style="text-transform: uppercase;">
                            </div>

                            <!-- Parents -->
                            <div class="form-group">
                                <label>Father's / Husband's Name <span class="required">*</span></label>
                                <input type="text" name="father_name" required>
                            </div>
                            <div class="form-group">
                                <label>Mother's Name <span class="required">*</span></label>
                                <input type="text" name="mother_name" required>
                            </div>

                            <!-- DOB & Gender -->
                            <div class="form-group">
                                <label>Date of Birth <span class="required">*</span></label>
                                <input type="date" name="dob" required>
                            </div>
                            <div class="form-group">
                                <label>Sex <span class="required">*</span></label>
                                <select name="gender" required>
                                    <option value="">Select</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <!-- Nationality & Marital -->
                            <div class="form-group">
                                <label>Nationality <span class="required">*</span></label>
                                <input type="text" name="nationality" value="Indian" required>
                            </div>
                            <div class="form-group">
                                <label>Marital Status <span class="required">*</span></label>
                                <select name="marital_status" required>
                                    <option value="Single">Single</option>
                                    <option value="Married">Married</option>
                                </select>
                            </div>

                            <!-- Category -->
                            <div class="form-group">
                                <label>Category (SC/ST/OBC/Gen) <span class="required">*</span></label>
                                <select name="category" onchange="toggleProof(this.value)" required>
                                    <option value="General">General</option>
                                    <option value="SC">SC</option>
                                    <option value="ST">ST</option>
                                    <option value="OBC">OBC</option>
                                    <option value="MOBC">MOBC</option>
                                </select>
                            </div>
                            <div class="form-group" id="proofUpload" style="display: none;">
                                <label>Attach Category Proof</label>
                                <input type="file" name="category_proof" accept="image/*,.pdf">
                            </div>

                            <!-- Blood & Aadhaar -->
                            <div class="form-group">
                                <label>Blood Group</label>
                                <select name="blood_group">
                                    <option value="">Select</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Aadhaar No. <span class="required">*</span></label>
                                <input type="text" name="aadhaar" pattern="[0-9]{12}"
                                    placeholder="12 Digit Aadhaar Number" required>
                            </div>
                        </div>
                    </div>

                    <script>
                        function toggleProof(val) {
                            document.getElementById('proofUpload').style.display = (val === 'General') ? 'none' : 'block';
                        }

                        function previewImage(input) {
                            if (input.files && input.files[0]) {
                                var reader = new FileReader();
                                reader.onload = function (e) {
                                    document.getElementById('photoPreviewImg').src = e.target.result;
                                    document.getElementById('photoPreviewImg').style.display = 'block';
                                    document.querySelector('#photoPreviewBox span').style.display = 'none';
                                }
                                reader.readAsDataURL(input.files[0]);
                            }
                        }
                    </script>

                    <!-- Address Details -->
                    <div class="form-section">
                        <h3 class="section-title">2. Address Details</h3>

                        <!-- Correspondence -->
                        <div style="background: #f9f9f9; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                            <h4 style="margin-bottom: 15px; color: var(--gold);">Address For Correspondence</h4>
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label>Vill / Town / Street <span class="required">*</span></label>
                                    <input type="text" name="corr_street" required>
                                </div>
                                <div class="form-group">
                                    <label>District <span class="required">*</span></label>
                                    <input type="text" name="corr_dist" required>
                                </div>
                                <div class="form-group">
                                    <label>PO <span class="required">*</span></label>
                                    <input type="text" name="corr_po" required>
                                </div>
                                <div class="form-group">
                                    <label>State <span class="required">*</span></label>
                                    <input type="text" name="corr_state" required>
                                </div>
                                <div class="form-group">
                                    <label>PIN Code <span class="required">*</span></label>
                                    <input type="text" name="corr_pin" pattern="[0-9]{6}" required>
                                </div>
                            </div>
                        </div>

                        <!-- Permanent -->
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0; color: var(--deep-blue);">Permanent Address</h4>
                                <label style="font-size: 0.9rem; margin: 0; cursor: pointer;">
                                    <input type="checkbox" id="sameAsCorr" onchange="copyAddress()"> Same as
                                    Correspondence
                                </label>
                            </div>
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label>Vill / Town / Street <span class="required">*</span></label>
                                    <input type="text" name="perm_street" id="perm_street" required>
                                </div>
                                <div class="form-group">
                                    <label>District <span class="required">*</span></label>
                                    <input type="text" name="perm_dist" id="perm_dist" required>
                                </div>
                                <div class="form-group">
                                    <label>PO <span class="required">*</span></label>
                                    <input type="text" name="perm_po" id="perm_po" required>
                                </div>
                                <div class="form-group">
                                    <label>State <span class="required">*</span></label>
                                    <input type="text" name="perm_state" id="perm_state" required>
                                </div>
                                <div class="form-group">
                                    <label>PIN Code <span class="required">*</span></label>
                                    <input type="text" name="perm_pin" id="perm_pin" pattern="[0-9]{6}" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        function copyAddress() {
                            if (document.getElementById('sameAsCorr').checked) {
                                document.getElementById('perm_street').value = document.querySelector('[name="corr_street"]').value;
                                document.getElementById('perm_dist').value = document.querySelector('[name="corr_dist"]').value;
                                document.getElementById('perm_po').value = document.querySelector('[name="corr_po"]').value;
                                document.getElementById('perm_state').value = document.querySelector('[name="corr_state"]').value;
                                document.getElementById('perm_pin').value = document.querySelector('[name="corr_pin"]').value;
                            } else {
                                // Optional: Clear fields
                                document.getElementById('perm_street').value = '';
                                document.getElementById('perm_dist').value = '';
                                document.getElementById('perm_po').value = '';
                                document.getElementById('perm_state').value = '';
                                document.getElementById('perm_pin').value = '';
                            }
                        }
                    </script>

                    <!-- Contact Details (Existing reused) -->
                    <div class="form-section">
                        <h3 class="section-title">3. Contact Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Mobile No <span class="required">*</span></label>
                                <input type="tel" name="mobile_no" pattern="[0-9]{10}" required>
                            </div>
                            <div class="form-group">
                                <label>E-Mail <span class="required">*</span></label>
                                <input type="email" name="email" required>
                            </div>
                        </div>
                    </div>

                    <!-- Educational Background -->
                    <div class="form-section">
                        <h3 class="section-title">4. Educational Background</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Highest Qualification <span class="required">*</span></label>
                                <input type="text" name="highest_qual" placeholder="e.g. Class 12, BA, MA" required>
                            </div>
                            <div class="form-group">
                                <label>Year of Passing <span class="required">*</span></label>
                                <input type="number" name="passing_year" placeholder="YYYY" min="1950" max="2030"
                                    required>
                            </div>
                            <div class="form-group full-width">
                                <label>Name of Institution / School / College <span class="required">*</span></label>
                                <input type="text" name="institution_name" required>
                            </div>
                        </div>
                    </div>

                    <!-- Course Details -->
                    <div class="form-section">
                        <h3 class="section-title">5. Course Details</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Course Name <span class="required">*</span></label>
                                <select name="course_name" required>
                                    <option value="">-- Select Course --</option>
                                    <option value="Diploma in Fine Arts">Diploma in Fine Arts</option>
                                    <option value="Diploma in Kathak">Diploma in Kathak</option>
                                    <option value="Diploma in Bharatanatyam">Diploma in Bharatanatyam</option>
                                    <option value="Hindustani Vocal">Hindustani Vocal</option>
                                    <option value="Theatre">Theatre & Dramatics</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Course Duration</label>
                                <input type="text" name="course_duration" placeholder="e.g. 1 Year / 6 Months">
                            </div>
                            <div class="form-group full-width">
                                <label>Preferred Batch <span class="required">*</span></label>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 5px;">
                                    <label style="font-weight: normal; cursor: pointer;">
                                        <input type="radio" name="batch" value="Morning" required> Morning
                                    </label>
                                    <label style="font-weight: normal; cursor: pointer;">
                                        <input type="radio" name="batch" value="Afternoon"> Afternoon
                                    </label>
                                    <label style="font-weight: normal; cursor: pointer;">
                                        <input type="radio" name="batch" value="Evening"> Evening
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Details -->
                    <div class="form-section">
                        <h3 class="section-title">6. Payment Details</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Course Fee (₹) <span class="required">*</span></label>
                                <input type="number" name="course_fee" placeholder="Amount Paid" required>
                            </div>
                            <div class="form-group">
                                <label>Payment Method <span class="required">*</span></label>
                                <select name="payment_method" required>
                                    <option value="">Select Method</option>
                                    <option value="Bank Transfer">Bank Transfer</option>
                                    <option value="Credit Card">Credit Card</option>
                                    <option value="UPI">UPI</option>
                                    <option value="Cash">Cash</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Transaction ID / Reference No.</label>
                                <input type="text" name="txn_id" placeholder="Enter Transaction Details">
                            </div>
                        </div>
                    </div>

                    <!-- Declaration -->
                    <div class="form-section"
                        style="background: #fff8e1; border: 1px solid #ffe082; padding: 20px; border-radius: 8px;">
                        <h3 class="section-title" style="color: #bf8d13; border-bottom-color: #ffe082;">Declaration</h3>
                        <p style="font-size: 0.95rem; line-height: 1.6; margin-bottom: 20px; color: #555;">
                            I hereby declare that the information provided above is true to the best of my knowledge.
                            I understand that any false information may result in the cancellation of my admission.
                        </p>

                        <div class="form-grid">
                            <div class="form-group text-center">
                                <label>Candidate Signature Upload <span class="required">*</span></label>
                                <input type="file" name="signature_candidate" accept="image/*" required>
                            </div>
                            <div class="form-group text-center">
                                <label>Parent/Guardian Signature (If under 18)</label>
                                <input type="file" name="signature_guardian" accept="image/*">
                            </div>
                        </div>

                        <div class="form-group">
                            <label
                                style="font-weight: normal; cursor: pointer; display: flex; gap: 10px; align-items: start;">
                                <input type="checkbox" required style="width: 20px; height: 20px; margin-top: 2px;">
                                <span>I agree to the Terms & Conditions and Rules of the Institution.</span>
                            </label>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <button type="button" class="btn-submit" onclick="openPreview()">Preview Application</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Preview Logic
        async function openPreview() {
            const form = document.getElementById('admissionForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const data = {};
            for (let [key, val] of formData.entries()) {
                data[key] = val;
            }

            // Helper for DataURL
            const fileToDataURL = (file) => new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => resolve(null);
                reader.readAsDataURL(file);
            });

            // Prepare Images
            let photoSrc = '';
            let sigCandSrc = '';
            let sigGuardSrc = '';

            if (data['student_photo'] instanceof File && data['student_photo'].size > 0) {
                photoSrc = await fileToDataURL(data['student_photo']);
            }
            if (data['signature_candidate'] instanceof File && data['signature_candidate'].size > 0) {
                sigCandSrc = await fileToDataURL(data['signature_candidate']);
            }
            if (data['signature_guardian'] instanceof File && data['signature_guardian'].size > 0) {
                sigGuardSrc = await fileToDataURL(data['signature_guardian']);
            }

            // --- Build HTML Structure ---
            let html = '';

            // 1. Personal Details Section
            html += `
                <div class="preview-section">
                    <div class="section-header"><h3>1. Candidate Profile</h3></div>
                    <div class="personal-layout">
                        <!-- Details -->
                        <div class="layout-details">
                            <div class="info-grid">
                                <div class="field-box full-width">
                                    <span class="field-label">Full Name</span>
                                    <div class="field-value">${data['full_name'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Date of Birth</span>
                                    <div class="field-value">${data['dob'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Gender</span>
                                    <div class="field-value">${data['gender'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Father's Name</span>
                                    <div class="field-value">${data['father_name'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Mother's Name</span>
                                    <div class="field-value">${data['mother_name'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Nationality</span>
                                    <div class="field-value">${data['nationality'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Category</span>
                                    <div class="field-value">${data['category'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Blood Group</span>
                                    <div class="field-value">${data['blood_group'] || '-'}</div>
                                </div>
                                <div class="field-box">
                                    <span class="field-label">Aadhaar No.</span>
                                    <div class="field-value">${data['aadhaar'] || '-'}</div>
                                </div>
                            </div>
                        </div>
                        <!-- Photo -->
                        <div class="layout-photo">
                            <div class="photo-box">
                                ${photoSrc ? `<img src="${photoSrc}">` : '<span>No Photo</span>'}
                            </div>
                            <div class="photo-label">Candidate Photo</div>
                        </div>
                    </div>
                </div>
            `;

            // 2. Address Section
            html += `
                <div class="preview-section">
                    <div class="section-header"><h3>2. Address Details</h3></div>
                    <div class="address-container">
                        <div class="addr-col">
                            <h4>Correspondence Address</h4>
                            <div class="field-box"><span class="field-label">Street / Vill</span><div class="field-value">${data['corr_street'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">PO</span><div class="field-value">${data['corr_po'] || '-'}</div></div>
                             <div class="field-box"><span class="field-label">District</span><div class="field-value">${data['corr_dist'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">State</span><div class="field-value">${data['corr_state'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">PIN</span><div class="field-value">${data['corr_pin'] || '-'}</div></div>
                        </div>
                        <div class="addr-col">
                            <h4>Permanent Address</h4>
                            <div class="field-box"><span class="field-label">Street / Vill</span><div class="field-value">${data['perm_street'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">PO</span><div class="field-value">${data['perm_po'] || '-'}</div></div>
                             <div class="field-box"><span class="field-label">District</span><div class="field-value">${data['perm_dist'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">State</span><div class="field-value">${data['perm_state'] || '-'}</div></div>
                            <div class="field-box"><span class="field-label">PIN</span><div class="field-value">${data['perm_pin'] || '-'}</div></div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div class="field-box"><span class="field-label">Mobile No</span><div class="field-value">${data['mobile_no'] || '-'}</div></div>
                        <div class="field-box"><span class="field-label">Email</span><div class="field-value">${data['email'] || '-'}</div></div>
                    </div>
                </div>
            `;

            // 3. Education & Course
            html += `
                <div class="preview-section">
                    <div class="section-header"><h3>3. Academic & Course Details</h3></div>
                    <div class="info-grid">
                        <div class="field-box"><span class="field-label">Highest Qualification</span><div class="field-value">${data['highest_qual'] || '-'}</div></div>
                        <div class="field-box"><span class="field-label">Passing Year</span><div class="field-value">${data['passing_year'] || '-'}</div></div>
                        <div class="field-box full-width"><span class="field-label">Institution</span><div class="field-value">${data['institution_name'] || '-'}</div></div>
                        
                        <div class="field-box"><span class="field-label">Selected Course</span><div class="field-value" style="color:var(--primary); font-weight:700;">${data['course_name'] || '-'}</div></div>
                        <div class="field-box"><span class="field-label">Preferred Batch</span><div class="field-value">${data['batch'] || '-'}</div></div>
                    </div>
                </div>
            `;

            // 4. Payment
            html += `
                 <div class="preview-section">
                    <div class="section-header"><h3>4. Payment Details</h3></div>
                    <div class="info-grid">
                        <div class="field-box"><span class="field-label">Amount Paid</span><div class="field-value">₹ ${data['course_fee'] || '-'}</div></div>
                        <div class="field-box"><span class="field-label">Payment Method</span><div class="field-value">${data['payment_method'] || '-'}</div></div>
                        <div class="field-box full-width"><span class="field-label">Transaction ID / Ref</span><div class="field-value">${data['txn_id'] || '-'}</div></div>
                    </div>
                </div>
            `;

            // 5. Declaration
            html += `
                <div class="declaration-box">
                    <strong>Declaration:</strong><br>
                    I hereby declare that the information provided above is true to the best of my knowledge. 
                    I understand that any false information may result in the cancellation of my admission.
                    I agree to the Terms & Conditions and Rules of the Institution.
                </div>

                <div class="signatures">
                    <div class="sig-block">
                        ${sigCandSrc ? `<img src="${sigCandSrc}" class="sig-img">` : '<div style="height:50px;"></div>'}
                        <div class="sig-line">Signature of Candidate</div>
                    </div>
                    <div class="sig-block">
                        ${sigGuardSrc ? `<img src="${sigGuardSrc}" class="sig-img">` : '<div style="height:50px;"></div>'}
                        <div class="sig-line">Parent/Guardian Signature</div>
                    </div>
                </div>
            `;

            try {
                sessionStorage.setItem('admissionPreviewHTML', html);
                window.open('admissionPreview.html', '_blank');
            } catch (e) {
                console.error(e);
                alert('Preview generation failed (likely due to file size limits). Please ensure images are optimized.');
            }
        }



        // Listen for Final Submit from Preview Window
        window.addEventListener('message', async (event) => {
            if (event.data === 'TRIGGER_SUBMISSION') {
                const form = document.getElementById('admissionForm');
                const formData = new FormData(form);
                const formObject = {};

                // Convert FormData to JSON object
                formData.forEach((value, key) => {
                    // Check if key already exists (for checkboxes/arrays)
                    if (formObject[key]) {
                        if (!Array.isArray(formObject[key])) {
                            formObject[key] = [formObject[key]];
                        }
                        formObject[key].push(value);
                    } else {
                        formObject[key] = value;
                    }
                });

                // Handle Files - Simplify for JSON submission (In real app, use FormData directly or upload separately)
                // For this implementation, we will extract filenames to store in JSON, 
                // assuming actual file handling is done via standard form submission or separate API in a full implementation.
                // NOTE: Detailed file upload handling requires 'multipart/form-data' which is not sending JSON.
                // To keep it consistent with Franchise implementation:
                // We send JSON. The backend expects JSON. File *contents* won't be sent this way easily without Base64.
                // For now, we mimic the franchise behavior: Send Metadata. 

                // Remove File objects from JSON to avoid empty {}
                for (let key in formObject) {
                    if (formObject[key] instanceof File) {
                        formObject[key] = formObject[key].name; // Just save name for reference
                    }
                }

                try {
                    console.log('Submitting to backend...');
                    const ref = 'ADM-' + Math.floor(100000 + Math.random() * 900000);

                    const response = await fetch('http://localhost/Yoga_Web/Yoga_Backend/Admission/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            reference_no: ref,
                            form_data: formObject
                        })
                    });

                    const text = await response.text();
                    let result;
                    try {
                        result = JSON.parse(text);
                    } catch (e) {
                        throw new Error('Invalid Server Response: ' + text);
                    }

                    if (!response.ok) {
                        throw new Error(result.error || 'Submission Failed');
                    }

                    // Success
                    const successRef = result.ref_no || ref;
                    event.source.postMessage('SUBMISSION_SUCCESS:' + successRef, '*');

                    // Optional: Redirect to a success page or Home (delayed)
                    // alert('Admission Application Submitted Successfully! Reference No: ' + successRef);
                    // window.location.href = 'index.html'; // Don't redirect immediately so user can download from preview

                } catch (error) {
                    console.error('Submission Error:', error);
                    event.source.postMessage('SUBMISSION_ERROR:' + error.message, '*');
                }
            }
        });
    </script>

    <footer class="site-footer">
        <div class="container footer-grid">
            <div>
                <h3>Edvayu Educational Foundations</h3>
                <p>Morigaon 782105, Assam, India<br />Phone: +91 98765 43210<br />Email: contact@niac.edu.in</p>
            </div>
            <div class="social">
                <h4>Follow Us</h4>
                <ul>
                    <li><a href="#" aria-label="Facebook">Facebook</a></li>
                    <li><a href="#" aria-label="Instagram">Instagram</a></li>
                    <li><a href="#" aria-label="YouTube">YouTube</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">© 2025 Edvayu Educational Foundations.</div>
    </footer>

    <script src="script.js"></script>
</body>

</html>